from app.database import SessionLocal
from app.models.user import User, Dataset, Donnee
from datetime import datetime

# Données à insérer
data = {
    "datetime": [
        "1991-07-01", "1991-08-01", "1991-09-01", "1991-10-01", "1991-11-01", "1991-12-01",
        "1992-01-01", "1992-02-01", "1992-03-01", "1992-04-01", "1992-05-01", "1992-06-01",
        "1992-07-01", "1992-08-01", "1992-09-01", "1992-10-01", "1992-11-01", "1992-12-01",
        "1993-01-01", "1993-02-01", "1993-03-01", "1993-04-01", "1993-05-01", "1993-06-01",
        "1993-07-01", "1993-08-01", "1993-09-01", "1993-10-01", "1993-11-01", "1993-12-01",
        "1994-01-01", "1994-02-01", "1994-03-01", "1994-04-01", "1994-05-01", "1994-06-01",
        "1994-07-01", "1994-08-01", "1994-09-01", "1994-10-01", "1994-11-01", "1994-12-01",
        "1995-01-01", "1995-02-01", "1995-03-01", "1995-04-01", "1995-05-01", "1995-06-01",
        "1995-07-01", "1995-08-01", "1995-09-01", "1995-10-01", "1995-11-01", "1995-12-01",
        "1996-01-01", "1996-02-01", "1996-03-01", "1996-04-01", "1996-05-01", "1996-06-01",
        "1996-07-01", "1996-08-01", "1996-09-01", "1996-10-01", "1996-11-01", "1996-12-01",
        "1997-01-01", "1997-02-01", "1997-03-01", "1997-04-01", "1997-05-01", "1997-06-01",
        "1997-07-01", "1997-08-01", "1997-09-01", "1997-10-01", "1997-11-01", "1997-12-01"
    ],
    "value": [
        3.526591, 3.180891, 3.252221, 3.611003, 3.565869, 4.306371,
        5.088335, 2.81452, 2.985811, 3.20478, 3.127578, 3.270523,
        3.73785082, 3.55877609, 3.77720173, 3.92449042, 4.38653092, 5.81054917,
        6.19206769, 3.45085699, 3.77230686, 3.7343029, 3.90539892, 4.04968714,
        4.31556552, 4.56218455, 4.60866203, 4.66785129, 5.09384145, 7.1799622,
        6.73147308, 3.84127758, 4.39407557, 4.07534073, 4.5406449, 4.64561508,
        4.75260653, 5.35060467, 5.20445484, 5.3016513, 5.77374216, 6.20459348,
        6.74948382, 4.21606735, 4.94934946, 4.8230449, 5.19475419, 5.17078711,
        5.25674157, 5.85527729, 5.49072901, 6.11529323, 6.08847284, 7.41659792,
        8.32945212, 5.06979585, 5.26255667, 5.59712628, 6.110296, 5.68916084,
        6.48684933, 6.30056933, 6.46747574, 6.82862939, 6.64907826, 8.60693721,
        8.52447101, 5.27791837, 5.71430345, 6.21452908, 6.41192919, 6.66771564,
        7.05083102, 6.70491861, 7.25098761, 7.81973318, 7.39810106, 10.09623339
    ]
}

# Connexion à la base
db = SessionLocal()

# 1. Création d’un utilisateur
user = User(
    nom="Alice",
    email="alice@example.com",
    mdp="hashedpassword",
    secteur="électricité",
    photodeprofil="default.jpg"
)
db.add(user)
db.commit()
db.refresh(user)

# 2. Création du dataset associé
dataset = Dataset(
    uniteX="Mois",
    uniteY="Valeur",
    type="Consommation",
    user_id=user.id
)
db.add(dataset)
db.commit()
db.refresh(dataset)

# 3. Ajout des données
for i in range(len(data["datetime"])):
    date = data["datetime"][i]
    valeur = data["value"][i]
    mois_index = i  # ou bien tu peux convertir `date` en timestamp si besoin

    donnee = Donnee(
        x=mois_index,
        y=valeur,
        dataset_id=dataset.id
    )
    db.add(donnee)

db.commit()
db.close()

print("✅ Données insérées avec succès.")
